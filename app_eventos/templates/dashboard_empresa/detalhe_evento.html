{% extends 'dashboard_empresa/base.html' %}

{% block title %}{{ evento.nome }} - {{ empresa.nome_fantasia }}{% endblock %}
{% block page_title %}Detalhes do Evento{% endblock %}

{% block content %}
<!-- Breadcrumb -->
<nav aria-label="breadcrumb">
    <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="{% url 'dashboard_empresa:dashboard_empresa' %}">Dashboard</a></li>
        <li class="breadcrumb-item"><a href="{% url 'dashboard_empresa:eventos_empresa' %}">Eventos</a></li>
        <li class="breadcrumb-item active">{{ evento.nome }}</li>
    </ol>
</nav>

<!-- Informações do Evento -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card shadow">
            <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                <h5 class="mb-0"><i class="fas fa-calendar-alt me-2"></i>{{ evento.nome }}</h5>
                <div>
                    <a href="{% url 'dashboard_empresa:editar_evento' evento.id %}" class="btn btn-light btn-sm me-2">
                        <i class="fas fa-edit"></i> Editar
                    </a>
                    <a href="{% url 'dashboard_empresa:gerenciar_vagas_evento' evento.id %}" class="btn btn-warning btn-sm me-2">
                        <i class="fas fa-briefcase"></i> Gerenciar Vagas
                    </a>
                    <a href="{% url 'dashboard_empresa:notificar_freelancers_evento' evento.id %}" class="btn btn-success btn-sm me-2">
                        <i class="fas fa-paper-plane"></i> Notificar Freelancers
                    </a>
                </div>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <h6 class="text-primary">Informações Gerais</h6>
                        <p class="mb-1"><strong>Data Início:</strong> {{ evento.data_inicio|date:"d/m/Y" }}</p>
                        <p class="mb-1"><strong>Data Fim:</strong> {{ evento.data_fim|date:"d/m/Y" }}</p>
                        <p class="mb-1"><strong>Local:</strong> {% if evento.local %}{{ evento.local.nome }}{% else %}Não definido{% endif %}</p>
                        <p class="mb-3">
                            <strong>Status:</strong> 
                            {% if evento.ativo %}
                                <span class="badge bg-success">Ativo</span>
                            {% else %}
                                <span class="badge bg-secondary">Inativo</span>
                            {% endif %}
                        </p>
                    </div>
                    <div class="col-md-6">
                        <h6 class="text-primary">Estatísticas</h6>
                        <p class="mb-1"><strong>Setores:</strong> {{ stats_evento.total_setores }}</p>
                        <p class="mb-1">
                            <strong>Vagas:</strong> {{ stats_evento.total_vagas }} ({{ stats_evento.vagas_ativas }} ativas)
                            <a href="{% url 'dashboard_empresa:gerenciar_vagas_evento' evento.id %}" class="btn btn-sm btn-outline-primary ms-2">
                                <i class="fas fa-cog"></i> Gerenciar
                            </a>
                        </p>
                        <p class="mb-1"><strong>Candidaturas:</strong> {{ stats_evento.total_candidaturas }}</p>
                        <p class="mb-1"><strong>Freelancers Aprovados:</strong> <span class="badge bg-success">{{ stats_evento.total_freelancers_aprovados }}</span></p>
                    </div>
                </div>
                
                {% if evento.descricao %}
                <hr>
                <h6 class="text-primary">Descrição</h6>
                <p>{{ evento.descricao }}</p>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<!-- Estatísticas das Candidaturas -->
<div class="row mb-4">
    <div class="col-md-3">
        <div class="card text-center">
            <div class="card-body">
                <h3 class="text-primary">{{ stats_evento.total_candidaturas }}</h3>
                <p class="text-muted mb-0">Total Candidaturas</p>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card text-center">
            <div class="card-body">
                <h3 class="text-success">{{ stats_evento.aprovadas }}</h3>
                <p class="text-muted mb-0">Aprovadas</p>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card text-center">
            <div class="card-body">
                <h3 class="text-warning">{{ stats_evento.pendentes }}</h3>
                <p class="text-muted mb-0">Pendentes</p>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card text-center">
            <div class="card-body">
                <h3 class="text-danger">{{ stats_evento.rejeitadas }}</h3>
                <p class="text-muted mb-0">Rejeitadas</p>
            </div>
        </div>
    </div>
</div>

<!-- Freelancers Aprovados -->
<div class="row">
    <div class="col-12">
        <div class="card shadow">
            <div class="card-header bg-success text-white d-flex justify-content-between align-items-center">
                <h5 class="mb-0">
                    <i class="fas fa-check-circle me-2"></i>
                    Freelancers Aprovados ({{ stats_evento.total_freelancers_aprovados }})
                </h5>
                <button class="btn btn-light btn-sm">
                    <i class="fas fa-download me-1"></i>Exportar Lista
                </button>
            </div>
            <div class="card-body">
                {% if candidaturas_aprovadas %}
                    <div class="table-responsive">
                        <table class="table table-bordered table-hover">
                            <thead class="table-light">
                                <tr>
                                    <th>#</th>
                                    <th>Freelancer</th>
                                    <th>Telefone</th>
                                    <th>Email</th>
                                    <th>Setor</th>
                                    <th>Vaga</th>
                                    <th>Remuneração</th>
                                    <th>Ações</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for cand in candidaturas_aprovadas %}
                                <tr>
                                    <td>{{ forloop.counter }}</td>
                                    <td>
                                        <i class="fas fa-user-circle text-success me-2"></i>
                                        <strong>{{ cand.freelance.nome_completo }}</strong>
                                    </td>
                                    <td>
                                        <a href="tel:{{ cand.freelance.telefone }}" class="text-decoration-none">
                                            <i class="fas fa-phone me-1"></i>{{ cand.freelance.telefone }}
                                        </a>
                                    </td>
                                    <td>
                                        <a href="mailto:{{ cand.freelance.email }}" class="text-decoration-none">
                                            <i class="fas fa-envelope me-1"></i>{{ cand.freelance.email }}
                                        </a>
                                    </td>
                                    <td>
                                        <span class="badge bg-info">{{ cand.vaga.setor.nome }}</span>
                                    </td>
                                    <td>{{ cand.vaga.titulo }}</td>
                                    <td class="text-success">
                                        <strong>R$ {{ cand.vaga.remuneracao }}</strong>
                                        <br>
                                        <small class="text-muted">{{ cand.vaga.get_tipo_remuneracao_display }}</small>
                                    </td>
                                    <td>
                                        <a href="{% url 'dashboard_empresa:detalhe_candidatura' cand.id %}" class="btn btn-sm btn-info" title="Ver detalhes">
                                            <i class="fas fa-eye"></i>
                                        </a>
                                        <button class="btn btn-sm btn-primary" title="Enviar mensagem">
                                            <i class="fas fa-envelope"></i>
                                        </button>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="alert alert-success mt-3">
                        <i class="fas fa-info-circle me-2"></i>
                        <strong>{{ stats_evento.total_freelancers_aprovados }} freelancer(s) aprovado(s)</strong> para este evento.
                        Você pode entrar em contato com eles pelos telefones e emails listados acima.
                    </div>
                {% else %}
                    <div class="text-center py-5">
                        <i class="fas fa-users-slash fa-3x text-muted mb-3"></i>
                        <h5 class="text-muted">Nenhum freelancer aprovado ainda</h5>
                        <p class="text-muted">Quando candidaturas forem aprovadas, os freelancers aparecerão aqui.</p>
                        <a href="{% url 'dashboard_empresa:candidaturas_empresa' %}" class="btn btn-primary">
                            <i class="fas fa-list me-2"></i>Ver Candidaturas Pendentes
                        </a>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<!-- Setores e Vagas -->
<div class="row mt-4">
    <div class="col-12">
        <div class="card shadow">
            <div class="card-header bg-info text-white">
                <h5 class="mb-0"><i class="fas fa-sitemap me-2"></i>Setores e Vagas</h5>
            </div>
            <div class="card-body">
                {% if setores %}
                    {% for setor in setores %}
                        <div class="mb-4">
                            <div class="d-flex justify-content-between align-items-center mb-2">
                                <h6 class="text-info mb-0">
                                    <i class="fas fa-layer-group me-2"></i>{{ setor.nome }}
                                </h6>
                                <a href="{% url 'dashboard_empresa:criar_vaga' setor.id %}" class="btn btn-sm btn-primary">
                                    <i class="fas fa-plus me-1"></i>Adicionar Vaga
                                </a>
                            </div>
                            {% if setor.descricao %}
                                <p class="text-muted small">{{ setor.descricao }}</p>
                            {% endif %}
                            {% if setor.vagas.all %}
                                <div class="table-responsive">
                                    <table class="table table-sm table-bordered">
                                        <thead class="table-light">
                                            <tr>
                                                <th>Vaga</th>
                                                <th>Quantidade</th>
                                                <th>Remuneração</th>
                                                <th>Candidaturas</th>
                                                <th>Status</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% for vaga in setor.vagas.all %}
                                            <tr>
                                                <td>{{ vaga.titulo }}</td>
                                                <td>{{ vaga.quantidade }}</td>
                                                <td>R$ {{ vaga.remuneracao }}</td>
                                                <td>{{ vaga.candidaturas.count }}</td>
                                                <td>
                                                    {% if vaga.ativa %}
                                                        <span class="badge bg-success">Ativa</span>
                                                    {% else %}
                                                        <span class="badge bg-secondary">Inativa</span>
                                                    {% endif %}
                                                </td>
                                            </tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                            {% else %}
                                <p class="text-muted">Nenhuma vaga neste setor</p>
                            {% endif %}
                        </div>
                    {% endfor %}
                {% else %}
                    <p class="text-muted">Nenhum setor criado para este evento</p>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<!-- Botões de Ação -->
<div class="row mt-4">
    <div class="col-12">
        <a href="{% url 'dashboard_empresa:eventos_empresa' %}" class="btn btn-secondary">
            <i class="fas fa-arrow-left me-2"></i>Voltar para Eventos
        </a>
        <a href="{% url 'dashboard_empresa:criar_setor' evento.id %}" class="btn btn-primary">
            <i class="fas fa-plus me-2"></i>Adicionar Setor
        </a>
        <button class="btn btn-warning">
            <i class="fas fa-edit me-2"></i>Editar Evento
        </button>
    </div>
</div>

<!-- Toast para feedback -->
<div class="toast-container position-fixed bottom-0 end-0 p-3">
    <div id="toast-notificacao" class="toast" role="alert">
        <div class="toast-header">
            <i class="fas fa-bell text-primary me-2"></i>
            <strong class="me-auto">Notificação</strong>
            <button type="button" class="btn-close" data-bs-dismiss="toast"></button>
        </div>
        <div class="toast-body" id="toast-message">
            <!-- Mensagem será inserida aqui -->
        </div>
    </div>
</div>

{% csrf_token %}

<script>
document.addEventListener('DOMContentLoaded', function() {
    const toast = document.getElementById('toast-notificacao');
    const toastMessage = document.getElementById('toast-message');
    
    
    function mostrarToast(tipo, mensagem) {
        toastMessage.textContent = mensagem;
        const toastInstance = new bootstrap.Toast(toast);
        toastInstance.show();
    }
});
</script>
{% endblock %}
